<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRUD Odontólogos</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <h1 class="mt-5">Gestión de Odontólogos</h1>

    <!-- Formulario para agregar/actualizar odontólogos -->
    <form id="odontologoForm" class="mt-3">
        <div class="form-group">
            <label for="nombre">Nombre</label>
            <input type="text" class="form-control" id="nombre" required>
        </div>
        <div class="form-group">
            <label for="apellido">Apellido</label>
            <input type="text" class="form-control" id="apellido" required>
        </div>
        <div class="form-group">
            <label for="matricula">Matrícula</label>
            <input type="text" class="form-control" id="matricula" required>
        </div>
        <input type="hidden" id="odontologoId">
        <button type="submit" class="btn btn-primary">Guardar</button>
    </form>

    <!-- Tabla para listar odontólogos -->
    <h2 class="mt-5">Lista de Odontólogos</h2>
    <table class="table mt-3">
        <thead>
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>Matrícula</th>
            <th>Acciones</th>
        </tr>
        </thead>
        <tbody id="odontologoTableBody">
        <!-- Los odontólogos se llenarán aquí -->
        </tbody>
    </table>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        const odontologoForm = document.getElementById('odontologoForm');
        const odontologoTableBody = document.getElementById('odontologoTableBody');

        // Fetch para cargar odontólogos existentes
        function loadOdontologos() {
            fetch('http://localhost:8082/odontologos')
                .then(response => response.json())
                .then(data => {
                    odontologoTableBody.innerHTML = '';
                    data.forEach(odontologo => {
                        odontologoTableBody.innerHTML += `
                                <tr>
                                    <td>${odontologo.id}</td>
                                    <td>${odontologo.nombre}</td>
                                    <td>${odontologo.apellido}</td>
                                    <td>${odontologo.matricula}</td>
                                    <td>
                                        <button class="btn btn-warning" onclick="editarOdontologo(${odontologo.id})">Editar</button>
                                        <button class="btn btn-danger" onclick="eliminarOdontologo(${odontologo.id})">Eliminar</button>
                                    </td>
                                </tr>
                            `;
                    });
                });
        }

        // Crear o actualizar un odontólogo
        odontologoForm.addEventListener('submit', function (e) {
            e.preventDefault();

            const odontologoId = document.getElementById('odontologoId').value;
            const nombre = document.getElementById('nombre').value;
            const apellido = document.getElementById('apellido').value;
            const matricula = document.getElementById('matricula').value;

            const odontologo = { nombre, apellido, matricula };

            let url = 'http://localhost:8082/odontologos';
            let method = 'POST';

            if (odontologoId) {
                url += `/${odontologoId}`;
                method = 'PUT';
            }

            fetch(url, {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(odontologo)
            })
                .then(() => {
                    odontologoForm.reset();
                    loadOdontologos();  // Recargar la lista de odontólogos
                });
        });

        // Editar un odontólogo
        window.editarOdontologo = function (id) {
            fetch(`http://localhost:8082/odontologos/${id}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('odontologoId').value = data.id;
                    document.getElementById('nombre').value = data.nombre;
                    document.getElementById('apellido').value = data.apellido;
                    document.getElementById('matricula').value = data.matricula;
                });
        };

        // Eliminar un odontólogo
        window.eliminarOdontologo = function (id) {
            fetch(`http://localhost:8082/odontologos/${id}`, { method: 'DELETE' })
                .then(() => loadOdontologos());
        };

        // Cargar los odontólogos al inicio
        loadOdontologos();
    });
</script>
</body>
</html>
